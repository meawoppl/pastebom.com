services:
  ibom-gist:
    build:
      context: .
      args:
        IBOM_REPO: https://github.com/meawoppl/InteractiveHtmlBom.git
        IBOM_BRANCH: meawoppl/optional-wx-dep
    ports:
      - "8081:8080"
    environment:
      - LOG_LEVEL=info
      # S3 configuration (required)
      - S3_BUCKET=${S3_BUCKET}
      - S3_REGION=${S3_REGION:-us-west-2}
      - S3_UPLOADS_PREFIX=${S3_UPLOADS_PREFIX:-uploads}
      - S3_BOMS_PREFIX=${S3_BOMS_PREFIX:-boms}
      # Optional: for LocalStack/MinIO testing
      # - S3_ENDPOINT_URL=http://localhost:4566
      # AWS credentials (or use IAM role)
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      # Set BASE_URL for production
      # - BASE_URL=https://pastebom.com
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 5s
      retries: 3
